<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:OpenChat.UI.ViewModels"
             mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="80"
             x:Class="OpenChat.UI.Controls.MessageBubble"
             x:DataType="vm:MessageViewModel">

    <Grid>
        <!-- Received Message (left aligned) -->
        <Border HorizontalAlignment="Left" MaxWidth="480"
                IsVisible="{Binding !IsFromCurrentUser}"
                Background="{StaticResource BubbleReceivedBrush}"
                CornerRadius="16,16,16,4" Padding="12,8">
            <StackPanel Spacing="4">
                <!-- Sender Name (for groups) -->
                <TextBlock Text="{Binding SenderName}"
                           Foreground="{StaticResource NostrPurpleLightBrush}"
                           FontSize="12" FontWeight="SemiBold"
                           IsVisible="{Binding IsFirstInGroup}" />

                <!-- Message Content -->
                <TextBlock Text="{Binding Content}"
                           Foreground="{StaticResource BubbleReceivedText}"
                           TextWrapping="Wrap" FontSize="14" />

                <!-- Timestamp -->
                <TextBlock Text="{Binding Timestamp, StringFormat={}{0:HH:mm}}"
                           Foreground="{StaticResource TextMutedBrush}"
                           FontSize="11" HorizontalAlignment="Right" />
            </StackPanel>
        </Border>

        <!-- Sent Message (right aligned) -->
        <Border HorizontalAlignment="Right" MaxWidth="480"
                IsVisible="{Binding IsFromCurrentUser}"
                Background="{StaticResource BubbleSentBrush}"
                CornerRadius="16,16,4,16" Padding="12,8">
            <StackPanel Spacing="4">
                <!-- Message Content -->
                <TextBlock Text="{Binding Content}"
                           Foreground="{StaticResource BubbleSentText}"
                           TextWrapping="Wrap" FontSize="14" />

                <!-- Timestamp -->
                <TextBlock Text="{Binding Timestamp, StringFormat={}{0:HH:mm}}"
                           Foreground="{StaticResource NostrPurpleAccent}"
                           FontSize="11" HorizontalAlignment="Right" Opacity="0.8" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
